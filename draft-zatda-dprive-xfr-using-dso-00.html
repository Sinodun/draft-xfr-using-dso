<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>DNS Zone Transfer using DNS Stateful Operations</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Use Cases for XFR-using-DSO"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Overview"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Transport"/>
<link href="#rfc.section.6" rel="Chapter" title="6 State Considerations"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Protocol Operation"/>
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 XuD SUBSCRIBE-XFR"/>
<link href="#rfc.section.7.1.1" rel="Chapter" title="7.1.1 SUBSCRIBE-XFR Request"/>
<link href="#rfc.section.7.1.2" rel="Chapter" title="7.1.2 SUBSCRIBE-XFR Response"/>
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 XuD Notifications"/>
<link href="#rfc.section.7.2.1" rel="Chapter" title="7.2.1 DSO-IXFR Message"/>
<link href="#rfc.section.7.2.2" rel="Chapter" title="7.2.2 Fallback to AXFR"/>
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 XuD UNSUBSCRIBE-XFR"/>
<link href="#rfc.section.7.3.1" rel="Chapter" title="7.3.1 UNSUBSCRIBE-XFR Message"/>
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 DNS Stateful Operations TLV Context Summary"/>
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations"/>
<link href="#rfc.section.9" rel="Chapter" title="9 Implementation Considerations"/>
<link href="#rfc.section.10" rel="Chapter" title="10 Implementation Status"/>
<link href="#rfc.section.11" rel="Chapter" title="11 IANA Considerations"/>
<link href="#rfc.section.12" rel="Chapter" title="12 Security Considerations"/>
<link href="#rfc.section.13" rel="Chapter" title="13 Acknowledgements"/>
<link href="#rfc.section.14" rel="Chapter" title="14 Changelog"/>
<link href="#rfc.references" rel="Chapter" title="15 References"/>
<link href="#rfc.references.1" rel="Chapter" title="15.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="15.2 Informative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.1 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Zhang, H., Aras, P., Toorop, W., Dickinson, S., and A. Mankin" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-zatda-dprive-xfr-using-dso-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2019-7-8" />
  <meta name="dct.abstract" content="DNS zone transfers are transmitted in clear text, which gives attackers the opportunity to collect the content of a zone by eavesdropping on network connections. This document specifies use of DNS Stateful Operations to enable a subscribe/publish mechanism for zone transfers reducing the over head introduced by NOTITY/SOA interactions prior to zone transfer request. This additionally prevents zone contents collection via passive monitoring of zone transfers by restricting XFR using DSO to require TLS.  " />
  <meta name="description" content="DNS zone transfers are transmitted in clear text, which gives attackers the opportunity to collect the content of a zone by eavesdropping on network connections. This document specifies use of DNS Stateful Operations to enable a subscribe/publish mechanism for zone transfers reducing the over head introduced by NOTITY/SOA interactions prior to zone transfer request. This additionally prevents zone contents collection via passive monitoring of zone transfers by restricting XFR using DSO to require TLS.  " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">dprive</td>
  <td class="right">H. Zhang</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">P. Aras</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">Salesforce</td>
</tr>
<tr>
  <td class="left">Expires: January 9, 2020</td>
  <td class="right">W. Toorop</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">NLnet Labs</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">S. Dickinson</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Sinodun IT</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">A. Mankin</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Salesforce</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">July 8, 2019</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">DNS Zone Transfer using DNS Stateful Operations<br />
  <span class="filename">draft-zatda-dprive-xfr-using-dso-00</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>DNS zone transfers are transmitted in clear text, which gives attackers the opportunity to collect the content of a zone by eavesdropping on network connections. This document specifies use of DNS Stateful Operations to enable a subscribe/publish mechanism for zone transfers reducing the over head introduced by NOTITY/SOA interactions prior to zone transfer request. This additionally prevents zone contents collection via passive monitoring of zone transfers by restricting XFR using DSO to require TLS.  </p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 9, 2020.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2019 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>2.   <a href="#rfc.section.2">Terminology</a></li>
<li>3.   <a href="#rfc.section.3">Use Cases for XFR-using-DSO</a></li>
<li>4.   <a href="#rfc.section.4">Overview</a></li>
<li>5.   <a href="#rfc.section.5">Transport</a></li>
<li>6.   <a href="#rfc.section.6">State Considerations</a></li>
<li>7.   <a href="#rfc.section.7">Protocol Operation</a></li>
<ul><li>7.1.   <a href="#rfc.section.7.1">XuD SUBSCRIBE-XFR</a></li>
<ul><li>7.1.1.   <a href="#rfc.section.7.1.1">SUBSCRIBE-XFR Request</a></li>
<li>7.1.2.   <a href="#rfc.section.7.1.2">SUBSCRIBE-XFR Response</a></li>
</ul><li>7.2.   <a href="#rfc.section.7.2">XuD Notifications</a></li>
<ul><li>7.2.1.   <a href="#rfc.section.7.2.1">DSO-IXFR Message</a></li>
<li>7.2.2.   <a href="#rfc.section.7.2.2">Fallback to AXFR</a></li>
</ul><li>7.3.   <a href="#rfc.section.7.3">XuD UNSUBSCRIBE-XFR</a></li>
<ul><li>7.3.1.   <a href="#rfc.section.7.3.1">UNSUBSCRIBE-XFR Message</a></li>
</ul><li>7.4.   <a href="#rfc.section.7.4">DNS Stateful Operations TLV Context Summary</a></li>
</ul><li>8.   <a href="#rfc.section.8">IANA Considerations</a></li>
<li>9.   <a href="#rfc.section.9">Implementation Considerations</a></li>
<li>10.   <a href="#rfc.section.10">Implementation Status</a></li>
<li>11.   <a href="#rfc.section.11">IANA Considerations</a></li>
<li>12.   <a href="#rfc.section.12">Security Considerations</a></li>
<li>13.   <a href="#rfc.section.13">Acknowledgements</a></li>
<li>14.   <a href="#rfc.section.14">Changelog</a></li>
<li>15.   <a href="#rfc.references">References</a></li>
<ul><li>15.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>15.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a></h1>
<p><a href="#I-D.hzpa-dprive-xfr-over-tls">[I-D.hzpa-dprive-xfr-over-tls]</a> enumerates the existing issues with clear text XFR mechanisms, outlines some use cases for using encrypted channels for zone transfer and also describes using TLS for zone transfers. It additionally discusses the various authentication mechanisms that can be used to provide data and channel authentication, and channel confidentiality.  </p>
<p id="rfc.section.1.p.2">This draft describes the use of a DSO <a href="#RFC8490">[RFC8490]</a> based protocol to perform zone transfers. This mechanism is heavily based on an existing use of DSO where DNS clients can subscribe to receive asynchronous notifications of changes to RRSets of interest: DNS PUSH Notifications <a href="#I-D.ietf-dnssd-push">[I-D.ietf-dnssd-push]</a>. That specification was developed with DNS Service Discovery in mind, this document describes an analogous protocol (XFR-using-DSO) where DNS clients can subscribe to receive asynchronous notifications of changes to zones of interest, it is developed with efficient and confidential zone transfers between primaries and secondaries in mind.  </p>
<p id="rfc.section.1.p.3">In the XFR-using-DSO model, a DSO connection is first opened between the client and server, the client can then subscribe to one more zones to be notified of changes and the server can push changes to the zone over the connection. Clients can choose to unSUBSCRIBE-XFR from zone updates at any time.  </p>
<p id="rfc.section.1.p.4">Servers can also use the DSO session to send command-style messages to the client, for example, to instruct a client to stop serving a zone or delete a zone.  </p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#terminology" id="terminology">Terminology</a></h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <a href="#RFC2119">[RFC2119]</a> and <a href="#RFC8174">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.  </p>
<p id="rfc.section.2.p.2">Privacy terminology is as described in Section 3 of <a href="#RFC6973">[RFC6973]</a>.  </p>
<p id="rfc.section.2.p.3">DNS terminology is as described in <a href="#RFC8499">[RFC8499]</a>.  </p>
<p id="rfc.section.2.p.4">DoT: DNS-over-TLS as specified in <a href="#RFC7858">[RFC7858]</a> </p>
<p id="rfc.section.2.p.5">XuD: XFR-using-DOS mechanisms as specified in this document </p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#use-cases-for-xfrusingdso" id="use-cases-for-xfrusingdso">Use Cases for XFR-using-DSO</a></h1>
<p id="rfc.section.3.p.1">This section includes additional use cases in addition to those specified in <a href="#I-D.hzpa-dprive-xfr-over-tls">[I-D.hzpa-dprive-xfr-over-tls]</a> that XuD can offer.  </p>
<p/>

<ul>
  <li>Security. For some network configurations it is not desirable to have port 53 on the secondary open to an untrusted network for the sole purpose of receiving NOTIFYs. NOTIFYs can also be trivially spoofed unless secured with TSIG. For the DSO case, secondaries could initiate DSO connections to the primary and following that server-initiated DSO NOTIFY messages could be sent on that connection which could simultaneously be used for SOA and IXFR requests. This would allow a firewall to be restricted to just allowing outgoing connections from secondary to primary. Note that a similar but more constrained mechanism exists for IXFR whereby a short refresh period can be configured which triggers periodic SOA/IXFR requests from the secondary. TODO: Look at the details of the NSD implementation.</li>
  <li>Performance. For the DSO case, a new subscribe/publish mechanism could be envisaged that greatly reducing the number of messages required to perform one transfer.</li>
  <li>Improved error handling and retries. In the DSO case new explicit error codes could be defined that allow a server to indicate the reason for a failed or aborted XFR request. Also a new client initiated message could be used to gracefully cancel AXFRs.</li>
  <li>New command channel. For the DSO case it would be possible to include new server-initiated 'control' commands e.g. 'stop serving this zone', 'delete this zone'.</li>
  <li>QUESTION: Is there any case where the primary might want to initiate the DSO connection to the secondary?</li>
</ul>

<p> </p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#overview" id="overview">Overview</a></h1>
<p id="rfc.section.4.p.1">The figure below provides an outline of the XuD protocol.  </p>
<p><a href="https://docs.google.com/drawings/d/1Jny_OFFXbazhtSAaCMak7nmBzhdzYpywkWz33IkrD7g/edit?usp=sharing">Figure 1: XuD protocol</a> </p>
<p id="rfc.section.4.p.3">A DNS XuD client subscribes for zone notifications for a particular zone by connecting to the appropriate authoritative server for that zone, and sending DSO message(s) indicating the zone(s) of interest. When the client loses interest in receiving further updates to these zones, it unsubscribes.  </p>
<p id="rfc.section.4.p.4">The authoritative server for a DNS zone is any server capable of generating the correct change notifications for a zone. It may be a primary, secondary, or stealth name server [RFC7719].  </p>
<p id="rfc.section.4.p.5">Standard DNS Queries MAY be sent over a XuD (i.e., DSO) session. For any zone for which the server is authoritative, it MUST respond authoritatively for queries on names falling within that zone both for normal DNS queries and for XuD subscriptions. For names for which the server is acting as a recursive resolver, e.g. when the server is the local recursive resolver, for any query for which it supports XuD subscriptions, it MUST also support standard queries.  </p>
<p id="rfc.section.4.p.6">XuD imposes less load on the responding server than rapid polling would, but XuD notifications do still have a cost, so XuD clients MUST only create XuD subscriptions for zones they are authorised to transfer.  </p>
<p id="rfc.section.4.p.7">Generally, as described in the DNS Stateful Operations specification [RFC8490], a client must not keep a session to a server open indefinitely if it has no subscriptions (or other operations) active on that session. A client MAY close a session as soon as it becomes idle, and then if needed in the future, open a new session when required. Alternatively, a client MAY speculatively keep an idle session open for some time, subject to the constraint that it MUST NOT keep a session open that has been idle for more than the session's idle timeout (15 seconds by default) [RFC8490].  </p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#transport" id="transport">Transport</a></h1>
<p id="rfc.section.5.p.1">XuD clients MUST use DNS Stateful Operations [RFC8490] running over TLS over TCP [RFC7858].  </p>
<p id="rfc.section.5.p.2">The connection for XuD SHOULD be established using port 853, as specified in <a href="#RFC7858">[RFC7858]</a>, unless there is mutual agreement between the secondary and primary to use a port other than port 853 for XuD.  </p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#state-considerations" id="state-considerations">State Considerations</a></h1>
<p id="rfc.section.6.p.1">Each XuD server is capable of handling some finite number of XuD subscriptions.  This number will vary from server to server and is based on physical machine characteristics, network bandwidth, and operating system resource allocation.  After a client establishes a session to a DNS server, each subscription is individually accepted or rejected. Servers may employ various techniques to limit subscriptions to a manageable level. Correspondingly, the client is free to establish simultaneous sessions to alternate DNS servers that support XuDs for the zone and distribute subscriptions at the client's discretion. In this way, both clients and servers can react to resource constraints.  </p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#protocol-operation" id="protocol-operation">Protocol Operation</a></h1>
<p id="rfc.section.7.p.1">The XuD protocol is a session-oriented protocol, and makes use of DNS Stateful Operations (DSO) [RFC8490].  </p>
<p id="rfc.section.7.p.2">For details of the DSO message format refer to the DNS Stateful Operations specification [RFC8490]. Those details are not repeated here.  </p>
<p id="rfc.section.7.p.3">XuD clients and servers MUST support DSO. A single server can support DNS Queries, DNS Updates, and XuD (using DSO) on the same TCP port.  </p>
<p id="rfc.section.7.p.4">A XuD exchange begins with the client making a TLS/TCP connection to the appropriate server.  </p>
<p id="rfc.section.7.p.5">A typical XuD client will immediately issue a DSO Keepalive operation to request a session timeout and/or keepalive interval longer than the the 15-second default values, but this is not required. A XuD client MAY issue other requests on the session first, and only issue a DSO Keepalive operation later if it determines that to be necessary. Sending either a DSO Keepalive operation or a XuD subscription over the TLS/TCP connection to the server signals the client's support of DSO and serves to establish a DSO session.  </p>
<p id="rfc.section.7.p.6">In accordance with the current set of active subscriptions, the server sends relevant asynchronous XuD notifications to the client. Note that a client MUST be prepared to receive (and silently ignore) XuD notifications for subscriptions it has previously removed, since there is no way to prevent the situation where a XuD notification is in flight from server to client while the client's UNSUBSCRIBE-XFR message cancelling that subscription is simultaneously in flight from client to server.  </p>
<h1 id="rfc.section.7.1"><a href="#rfc.section.7.1">7.1.</a> <a href="#xud-subscribexfr" id="xud-subscribexfr">XuD SUBSCRIBE-XFR</a></h1>
<p id="rfc.section.7.1.p.1">After connecting, and requesting a longer idle timeout and/or keepalive interval if necessary, a XuD client then indicates its desire to receive XuD notifications for a given zone by sending a SUBSCRIBE-XFR request to the server. A SUBSCRIBE-XFR request is encoded in a DSO message [RFC8490]. This specification defines a primary DSO TLV for XuD SUBSCRIBE-XFR Requests (tentatively DSO Type Code 0x50).  </p>
<p id="rfc.section.7.1.p.2">DSO messages with the SUBSCRIBE-XFR TLV as the Primary TLV are not permitted in early data.  </p>
<p id="rfc.section.7.1.p.3">The entity that initiates a SUBSCRIBE-XFR request is by definition the client. A server MUST NOT send a SUBSCRIBE-XFR request over an existing session from a client. If a server does send a SUBSCRIBE-XFR request over a DSO session initiated by a client, this is a fatal error and the client should immediately abort the connection with a TLS close_notify alert. See Section 6.1 of [RFC8446].  </p>
<p id="rfc.section.7.1.p.4">TODO: Need to define a DSO version of TSIG to cover the SUBSCRIBE-XFR and DSO-<em>XFR responses, since the Additional section count in DSO message MUST be zero. Note the client only needs to use TSIG in the SUBSCRIBE-XFR message to prove it is authorised to request zone transfers, but all DSO-</em>XFR messages should be signed if primary TSIG is required for the authentication model in use.  </p>
<h1 id="rfc.section.7.1.1"><a href="#rfc.section.7.1.1">7.1.1.</a> <a href="#subscribexfr-request" id="subscribexfr-request">SUBSCRIBE-XFR Request</a></h1>
<p id="rfc.section.7.1.1.p.1">A SUBSCRIBE-XFR request begins with the standard DSO 12-byte header [RFC8490], followed by the SUBSCRIBE-XFR primary TLV. A SUBSCRIBE-XFR request message is illustrated in Figure 2.  </p>
<p id="rfc.section.7.1.1.p.2">The MESSAGE ID field MUST be set to a unique value, that the client is not using for any other active operation on this DSO session. For the purposes here, a MESSAGE ID is in use on this session if the client has used it in a request for which it has not yet received a response, or if the client has used it for a subscription which it has not yet cancelled using UNSUBSCRIBE-XFR. In the SUBSCRIBE-XFR response the server MUST echo back the MESSAGE ID value unchanged.  </p>
<p id="rfc.section.7.1.1.p.3">The other header fields MUST be set as described in the DSO spec- ification [RFC8490]. The DNS OPCODE field contains the OPCODE value for DNS Stateful Operations (6). The four count fields MUST be zero, and the corresponding four sections MUST be empty (i.e., absent).  </p>
<p id="rfc.section.7.1.1.p.4">The DSO-TYPE is SUBSCRIBE-XFR (tentatively 0x50).  </p>
<p id="rfc.section.7.1.1.p.5">The DSO-LENGTH is the length of the DSO-DATA that follows, which specifies the name and class of the zone and optionally the SOA value of the client's version of the zone.  </p>
<p id="rfc.section.7.1.1.p.6">If the client has no copy of the zone it MUST omit the SOA value to indicate to the server that a DSO-AXFR is required in response (see the next section).  </p>
<pre>
                                 1  1  1  1  1  1
   0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+  \
 |                  MESSAGE ID                   |   \
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
 |QR| OPCODE(6) |         Z          |   RCODE   |    |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
 |             QDCOUNT (MUST BE ZERO)            |    |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+     &gt; HEADER
 |             ANCOUNT (MUST BE ZERO)            |    |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
 |             NSCOUNT (MUST BE ZERO)            |    |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
 |             ARCOUNT (MUST BE ZERO)            |   /
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+  /
 | DSO-TYPE = SUBSCRIBE-XFR (tentatively 0x50)   |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
 |   DSO-LENGTH (number of octets in DSO-DATA)   |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+  \
 |                                               |   \
 \                     NAME                      \    |
 \                                               \    |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+     &gt; DSO-DATA
 |                     CLASS                     |    |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
 |                     SOA                       |   /
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+  /
</pre>
<p id="rfc.section.7.1.1.p.7">Figure 2: SUBSCRIBE-XFR Request </p>
<p id="rfc.section.7.1.1.p.8">The DSO-DATA for a SUBSCRIBE-XFR request MUST contain exactly one NAME, CLASS and SOA value. Since SUBSCRIBE-XFR requests are sent over TCP, multiple SUBSCRIBE-XFR DSO request messages can be concatenated in a single TCP stream and packed efficiently into TCP segments.  </p>
<p id="rfc.section.7.1.1.p.9">If accepted, the subscription will stay in effect until the client cancels the subscription using UNSUBSCRIBE-XFR or until the DSO session between the client and the server is closed.  </p>
<p id="rfc.section.7.1.1.p.10">SUBSCRIBE-XFR requests on a given session MUST be unique. A client MUST NOT send a SUBSCRIBE-XFR message that duplicates the NAME, CLASS and SOA value of an existing active subscription on that DSO session. For the purpose of this matching, the established DNS case-insensitivity for US-ASCII letters applies (e.g., "example.com" and "Example.com" are the same). If a server receives such a duplicate SUBSCRIBE-XFR message this is an error and the server MUST immediately terminate the connection with a TLS close_notify alert.  </p>
<p id="rfc.section.7.1.1.p.11">QUESTION: Is there a use case where a client may want to signal that the version of the zone it holds has been updated via another mechanism and the zone transfer should restart from a different SOA than that currently exchanged between client and server? </p>
<p id="rfc.section.7.1.1.p.12">DNS wildcarding is not supported. SUBSCRIBE-XFR requests received for zones containing wildcards are considered an error (see below).  </p>
<p id="rfc.section.7.1.1.p.13">A CLASS of 'ANY' (255) is not supported.  </p>
<h1 id="rfc.section.7.1.2"><a href="#rfc.section.7.1.2">7.1.2.</a> <a href="#subscribexfr-response" id="subscribexfr-response">SUBSCRIBE-XFR Response</a></h1>
<p id="rfc.section.7.1.2.p.1">Each SUBSCRIBE-XFR request generates exactly one SUBSCRIBE-XFR response from the server. A SUBSCRIBE-XFR request message is illustrated in Figure 3.  </p>
<p id="rfc.section.7.1.2.p.2">A SUBSCRIBE-XFR response begins with the standard DSO 12-byte header [RFC8490]. The QR bit in the header is set indicating it is a response. The header MAY be followed by one or more optional TLVs, such as a Retry Delay TLV.  </p>
<p id="rfc.section.7.1.2.p.3">The MESSAGE ID field MUST echo the value given in the Message ID field of the SUBSCRIBE-XFR request. This is how the client knows which request is being responded to.  </p>
<p id="rfc.section.7.1.2.p.4">A SUBSCRIBE-XFR response message MUST NOT include a SUBSCRIBE-XFR TLV. If a client receives a SUBSCRIBE-XFR response message containing a SUBSCRIBE-XFR TLV then the response message is processed but the SUBSCRIBE-XFR TLV MUST be silently ignored.  </p>
<pre>
                                  1  1  1  1  1  1
    0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+  \
  |                  MESSAGE ID                   |   \
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
  |QR| OPCODE(6) |         Z          |   RCODE   |    |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
  |             QDCOUNT (MUST BE ZERO)            |    |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+     &gt; HEADER
  |             ANCOUNT (MUST BE ZERO)            |    |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
  |             NSCOUNT (MUST BE ZERO)            |    |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
  |             ARCOUNT (MUST BE ZERO)            |   /
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+  /
</pre>
<p id="rfc.section.7.1.2.p.5">Figure 3: SUBSCRIBE-XFR Response Message </p>
<p id="rfc.section.7.1.2.p.6">In the SUBSCRIBE-XFR response the RCODE indicates whether or not the subscription was accepted. Supported RCODEs are as follows: </p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Mnemonic</th>
      <th class="left">Value</th>
      <th class="left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">NOERROR</td>
      <td class="left">0</td>
      <td class="left">SUBSCRIBE-XFR successful.</td>
    </tr>
    <tr>
      <td class="left">FORMERR</td>
      <td class="left">1</td>
      <td class="left">Server failed to process request due to a</td>
    </tr>
    <tr>
      <td class="left"/>
      <td class="left"/>
      <td class="left">malformed request.</td>
    </tr>
    <tr>
      <td class="left">SERVFAIL</td>
      <td class="left">2</td>
      <td class="left">Server failed to process request due to a</td>
    </tr>
    <tr>
      <td class="left"/>
      <td class="left"/>
      <td class="left">problem with the server.</td>
    </tr>
    <tr>
      <td class="left">NOTIMP</td>
      <td class="left">4</td>
      <td class="left">Server does not implement DSO.</td>
    </tr>
    <tr>
      <td class="left">REFUSED</td>
      <td class="left">5</td>
      <td class="left">Server refuses to process request for policy</td>
    </tr>
    <tr>
      <td class="left"/>
      <td class="left"/>
      <td class="left">or security reasons.</td>
    </tr>
    <tr>
      <td class="left">NOTAUTH</td>
      <td class="left">9</td>
      <td class="left">Server is not authoritative for the requested</td>
    </tr>
    <tr>
      <td class="left"/>
      <td class="left"/>
      <td class="left">name.</td>
    </tr>
    <tr>
      <td class="left">DSOTYPENI</td>
      <td class="left">11</td>
      <td class="left">SUBSCRIBE-XFR operation not supported.</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.7.1.2.p.7">Table 1: SUBSCRIBE-XFR Response codes </p>
<p id="rfc.section.7.1.2.p.8">This document specifies only these RCODE values for SUBSCRIBE-XFR Responses.  Servers sending SUBSCRIBE-XFR Responses SHOULD use one of these values. Note that NXDOMAIN is not a valid RCODE in response to a SUBSCRIBE-XFR Request.  However, future circumstances may create situations where other RCODE values are appropriate in SUBSCRIBE-XFR Responses, so clients MUST be prepared to accept SUBSCRIBE-XFR Responses with any other RCODE value.  </p>
<p id="rfc.section.7.1.2.p.9">If the server sends a nonzero RCODE in the SUBSCRIBE-XFR response, that means: </p>
<p/>

<dl>
  <dt>a   </dt>
  <dd>the client is (at least partially) misconfigured,</dd>
  <dt>b   </dt>
  <dd>the server resources are exhausted, or</dd>
  <dt>c   </dt>
  <dd>there is some other unknown failure on the server.</dd>
</dl>

<p> </p>
<p id="rfc.section.7.1.2.p.11">In any case, the client shouldn't retry the subscription to this server right away. If a client has other authoritative servers configured for a given zone an alternative server can be tried immediately.  </p>
<p id="rfc.section.7.1.2.p.12">If the client has other successful subscriptions to this server, these subscriptions remain even though additional subscriptions may be refused.  Neither the client nor the server are required to close the connection, although, either end may choose to do so.  </p>
<p id="rfc.section.7.1.2.p.13">If the server sends a nonzero RCODE then it SHOULD append a Retry Delay TLV [RFC8490] to the response specifying a delay before the client attempts this operation again. Recommended values for the delay for different RCODE values are given below. These recommended values apply both to the default values a server should place in the Retry Delay TLV, and the default values a client should assume if the server provides no Retry Delay TLV.  </p>
<p id="rfc.section.7.1.2.p.14">For RCODE = 1 (FORMERR) the delay may be any value selected by the implementer.  A value of five minutes is RECOMMENDED, to reduce the risk of high load from defective clients.  </p>
<p id="rfc.section.7.1.2.p.15">For RCODE = 2 (SERVFAIL) the delay should be chosen according to the level of server overload and the anticipated duration of that overload. By default, a value of one minute is RECOMMENDED. If a more serious server failure occurs, the delay may be longer in accordance with the specific problem encountered.  </p>
<p id="rfc.section.7.1.2.p.16">For RCODE = 4 (NOTIMP), which occurs on a server that doesn't implement DNS Stateful Operations [RFC8490], it is unlikely that the server will begin supporting DSO in the next few minutes, so the retry delay SHOULD be one hour.  Note that in such a case, a server that doesn't implement DSO is unlikely to place a Retry Delay TLV in its response, so this recommended value in particular applies to what a client should assume by default.  </p>
<p id="rfc.section.7.1.2.p.17">For RCODE = 5 (REFUSED), which occurs on a server that implements XuDs, but is currently configured to disallow XuDs, the retry delay may be any value selected by the implementer and/or configured by the operator. Since it is possible that the misconfiguration may be repaired at any time, the retry delay should not be set too high. By default, a value of 5 minutes is RECOMMENDED.  </p>
<p id="rfc.section.7.1.2.p.18">For RCODE = 9 (NOTAUTH), which occurs on a server that implements XuDs, but is not configured to be authoritative for the requested name, the retry delay may be any value selected by the implementer and/or configured by the operator.  Since it is possible that the misconfiguration may be repaired at any time, the retry delay should not be set too high. By default, a value of 5 minutes is RECOMMENDED.  </p>
<p id="rfc.section.7.1.2.p.19">For RCODE = 11 (DSOTYPENI), which occurs on a server that implements DSO but doesn't implement XuD, it is unlikely that the server will begin supporting XuD in the next few minutes, so the retry delay SHOULD be one hour.  </p>
<p id="rfc.section.7.1.2.p.20">For other RCODE values, the retry delay should be set by the server as appropriate for that error condition. By default, a value of 5 minutes is RECOMMENDED.  </p>
<p id="rfc.section.7.1.2.p.21">For RCODE = 9 (NOTAUTH), the time delay applies to requests for other names falling within the same zone. Requests for names falling within other zones are not subject to the delay. For all other RCODEs the time delay applies to all subsequent requests to this server.  </p>
<p id="rfc.section.7.1.2.p.22">After sending an error response the server MAY allow the session to remain open, or MAY send a Retry Delay Operation TLV instructing the client to close the session, as described in the DSO specification [RFC8490]. Clients MUST correctly handle both cases.  </p>
<h1 id="rfc.section.7.2"><a href="#rfc.section.7.2">7.2.</a> <a href="#xud-notifications" id="xud-notifications">XuD Notifications</a></h1>
<p id="rfc.section.7.2.p.1">Once a subscription has been successfully established, the server generates DSO-IXFR messages to send to the client as appropriate. In the case that the server could not provide a DSO-IXFR message based on the SOA received from the client an initial DSO-AXFR message will be sent immediately following the SUBSCRIBE-XFR Response. Subsequent changes to the zone are then communicated to the client in subsequent DSO-IXFR messages.  </p>
<p id="rfc.section.7.2.p.2">Until an UNSUBSCRIBE-XFR message is received the server MUST assume that the client is updating the client's version of the zone with the notifications sent and can therefore hold state on the SOA version the client holds. It MUST use this to generate the DSO-IXFR messages sent on a XuD session.  </p>
<h1 id="rfc.section.7.2.1"><a href="#rfc.section.7.2.1">7.2.1.</a> <a href="#dsoixfr-message" id="dsoixfr-message">DSO-IXFR Message</a></h1>
<p id="rfc.section.7.2.1.p.1">A DSO-IXFR unidirectional message begins with the standard DSO 12-byte header [RFC8490], followed by the DSO-IXFR primary TLV. A DSO-IXFR message is illustrated in Figure 4.  </p>
<p id="rfc.section.7.2.1.p.2">In accordance with the definition of DSO unidirectional messages, the MESSAGE ID field MUST be zero. There is no client response to a DSO-IXFR message.  </p>
<p id="rfc.section.7.2.1.p.3">The other header fields MUST be set as described in the DSO specification [RFC8490]. The DNS OPCODE field contains the OPCODE value for DNS Stateful Operations (6). The four count fields MUST be zero, and the corresponding four sections MUST be empty (i.e., absent).  </p>
<p id="rfc.section.7.2.1.p.4">The DSO-TYPE is DSO-IXFR (tentatively 0x51).  </p>
<p id="rfc.section.7.2.1.p.5">The DSO-LENGTH is the length of the DSO-DATA that follows, which specifies the changes being communicated.  </p>
<p id="rfc.section.7.2.1.p.6">The DSO-DATA contains one or more change notifications. A DSO-IXFR Message MUST contain at least one change notification. If a DSO-IXFR Message is received that contains no change notifications, this is a fatal error, and the receiver MUST immediately terminate the connection with a TLS close_notify alert.  </p>
<pre>
                                 1  1  1  1  1  1
   0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+  \
 |           MESSAGE ID (MUST BE ZERO)           |   \
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
 |QR| OPCODE(6) |         Z          |   RCODE   |    |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
 |             QDCOUNT (MUST BE ZERO)            |    |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+     &gt; HEADER
 |             ANCOUNT (MUST BE ZERO)            |    |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
 |             NSCOUNT (MUST BE ZERO)            |    |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
 |             ARCOUNT (MUST BE ZERO)            |   /
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+  /
 |      DSO-TYPE = DSO-IXFR (tentatively 0x51)   |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
 |   DSO-LENGTH (number of octets in DSO-DATA)   |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+  \
 |                                               |   \
 |                                               |    |
 |            IXFR BODY AS PER RFC1995           |     &gt; DSO-DATA
 |                                               |    |
 |                                               |   /
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+  /
</pre>
<p id="rfc.section.7.2.1.p.7">Figure 4: DSO-IXFR Message </p>
<p id="rfc.section.7.2.1.p.8">The DSO-DATA in a DSO-IXFR message is identical to the contents of a <a href="#RFC1995">[RFC1995]</a> IXFR message that would be sent to communicate the same zone incremental zone transfer over UDP or TCP i.e. the set of one or more difference sequences that follow the DNS Header in an IXFR message.  </p>
<p id="rfc.section.7.2.1.p.9">When processing the records received in a DSO-IXFR Message, the receiving client MUST validate that the zone being updated correspond with at least one currently active subscription on that session. Specifically, the SOA name and CLASS MUST match the SOA name and CLASS given in a SUBSCRIBE-XFR request, subject to the usual established DNS case- insensitivity for US-ASCII letters.  </p>
<h1 id="rfc.section.7.2.2"><a href="#rfc.section.7.2.2">7.2.2.</a> <a href="#fallback-to-axfr" id="fallback-to-axfr">Fallback to AXFR</a></h1>
<p id="rfc.section.7.2.2.p.1">The format of the DSO-AXFR message is a standard DSO header with DSO-TYPE of DSO-AXFR (tentatively DSO Type Code 0x52) and the body is identical to a <a href="#RFC5936">[RFC5936]</a> AXFR response body.  </p>
<p id="rfc.section.7.2.2.p.2">TODO: More detail here.  </p>
<p id="rfc.section.7.2.2.p.3">If the SUBSCRIBE-XFR message contained no SOA value, the server MUST send a DSO-AXFR message as its first message on the connection.  </p>
<p id="rfc.section.7.2.2.p.4">Alternatively if incremental zone transfer is not available, the entire zone MAY be returned in a DSO-AXFR message.  </p>
<p id="rfc.section.7.2.2.p.5">QUESTION: Should we bother with a separate DSO-AXFR message or just allow full zone transfer inside the DSO-IXFR message as with <a href="#RFC1995">[RFC1995]</a> IXFR? A separate message type makes is more explicit and IXFR was constrained by having to respond to a IXFR request.  </p>
<h1 id="rfc.section.7.3"><a href="#rfc.section.7.3">7.3.</a> <a href="#xud-unsubscribexfr" id="xud-unsubscribexfr">XuD UNSUBSCRIBE-XFR</a></h1>
<p id="rfc.section.7.3.p.1">To cancel an individual subscription without closing the entire DSO session, the client sends an UNSUBSCRIBE-XFR message over the established DSO session to the server. The UNSUBSCRIBE-XFR message is encoded as a DSO unidirectional message [RFC8490]. This specification defines a primary unidirectional DSO TLV for XuD UNSUBSCRIBE-XFR Messages (tentatively DSO Type Code 0x53).  </p>
<p id="rfc.section.7.3.p.2">A server MUST NOT initiate an UNSUBSCRIBE-XFR message. If a server does send an UNSUBSCRIBE-XFR message over a DSO session initiated by a client, this is a fatal error and the client should immediately abort the connection with a TLS close_notify alert.  </p>
<h1 id="rfc.section.7.3.1"><a href="#rfc.section.7.3.1">7.3.1.</a> <a href="#unsubscribexfr-message" id="unsubscribexfr-message">UNSUBSCRIBE-XFR Message</a></h1>
<p id="rfc.section.7.3.1.p.1">An UNSUBSCRIBE-XFR unidirectional message begins with the standard DSO 12-byte header [RFC8490], followed by the UNSUBSCRIBE-XFR primary TLV. An UNSUBSCRIBE-XFR message is illustrated in Figure 5.  </p>
<p id="rfc.section.7.3.1.p.2">In accordance with the definition of DSO unidirectional messages, the MESSAGE ID field MUST be zero. There is no server response to an UNSUBSCRIBE-XFR message.  </p>
<p id="rfc.section.7.3.1.p.3">The other header fields MUST be set as described in the DSO spec- ification [RFC8490]. The DNS OPCODE field contains the OPCODE value for DNS Stateful Operations (6). The four count fields MUST be zero, and the corresponding four sections MUST be empty (i.e., absent).  </p>
<p id="rfc.section.7.3.1.p.4">The DSO-TYPE is UNSUBSCRIBE-XFR (tentatively 0x53).  </p>
<p id="rfc.section.7.3.1.p.5">The DSO-LENGTH field contains the value 2, the length of the 2-octet MESSAGE ID contained in the DSO-DATA.  </p>
<p id="rfc.section.7.3.1.p.6">The DSO-DATA contains the value given in the MESSAGE ID field of an active SUBSCRIBE-XFR request. This is how the server knows which SUBSCRIBE-XFR request is being cancelled. After receipt of the UNSUBSCRIBE-XFR message, the SUBSCRIBE-XFR request is no longer active.  </p>
<p id="rfc.section.7.3.1.p.7">It is allowable for the client to issue an UNSUBSCRIBE-XFR message for a previous SUBSCRIBE-XFR request for which the client has not yet received a SUBSCRIBE-XFR response. This is to allow for the case where a client starts and stops a subscription in less than the round-trip time to the server. The client is NOT required to wait for the SUBSCRIBE-XFR response before issuing the UNSUBSCRIBE-XFR message.  </p>
<p id="rfc.section.7.3.1.p.8">Consequently, it is possible for a server to receive an UNSUBSCRIBE-XFR message that does not match any currently active subscription. This can occur when a client sends a SUBSCRIBE-XFR request, which subsequently fails and returns an error code, but the client sent an UNSUBSCRIBE-XFR message before it became aware that the SUBSCRIBE-XFR request had failed. Because of this, servers MUST silently ignore UNSUBSCRIBE-XFR messages that do not match any currently active subscription.  </p>
<pre>
                                  1  1  1  1  1  1
    0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+  \
  |           MESSAGE ID (MUST BE ZERO)           |   \
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
  |QR| OPCODE(6) |         Z          |   RCODE   |    |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
  |             QDCOUNT (MUST BE ZERO)            |    |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+     &gt; HEADER
  |             ANCOUNT (MUST BE ZERO)            |    |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
  |             NSCOUNT (MUST BE ZERO)            |    |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+    |
  |             ARCOUNT (MUST BE ZERO)            |   /
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+  /
  | DSO-TYPE = UNSUBSCRIBE-XFR (tentatively 0x53) |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
  |                DSO-LENGTH (2)                 |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+  \
  |              SUBSCRIBE-XFR MESSAGE ID             |   &gt; DSO-DATA
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+  /
</pre>
<p id="rfc.section.7.3.1.p.9">Figure 5: UNSUBSCRIBE-XFR Message </p>
<p id="rfc.section.7.3.1.p.10">QUESTION: Do we need the equivalent of a RECONFIRM message from DNS PUSH Notifcations <a href="#I-D.ietf-dnssd-push">[I-D.ietf-dnssd-push]</a>? </p>
<h1 id="rfc.section.7.4"><a href="#rfc.section.7.4">7.4.</a> <a href="#dns-stateful-operations-tlv-context-summary" id="dns-stateful-operations-tlv-context-summary">DNS Stateful Operations TLV Context Summary</a></h1>
<p id="rfc.section.7.4.p.1">This document defines four new DSO TLVs. As suggested in Section 8.2 of the DNS Stateful Operations specification [RFC8490], the valid contexts of these new TLV types are summarized below.  </p>
<p id="rfc.section.7.4.p.2">The client TLV contexts are: </p>
<p id="rfc.section.7.4.p.3">C-P:  Client request message, primary TLV </p>
<p id="rfc.section.7.4.p.4">C-U:  Client unidirectional message, primary TLV </p>
<p id="rfc.section.7.4.p.5">C-A:  Client request or unidirectional message, additional TLV </p>
<p id="rfc.section.7.4.p.6">CRP:  Response back to client, primary TLV </p>
<p id="rfc.section.7.4.p.7">CRA:  Response back to client, additional TLV </p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">TLV Type</th>
      <th class="left">C-P</th>
      <th class="left">C-U</th>
      <th class="left">C-A</th>
      <th class="left">CRP</th>
      <th class="left">CRA</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">SUBSCRIBE-XFR</td>
      <td class="left">X</td>
      <td class="left"/>
      <td class="left"/>
      <td class="left"/>
      <td class="left"/>
    </tr>
    <tr>
      <td class="left">DSO-IXFR</td>
      <td class="left"/>
      <td class="left"/>
      <td class="left"/>
      <td class="left"/>
      <td class="left"/>
    </tr>
    <tr>
      <td class="left">DSO-AXFR</td>
      <td class="left"/>
      <td class="left"/>
      <td class="left"/>
      <td class="left"/>
      <td class="left"/>
    </tr>
    <tr>
      <td class="left">UNSUBSCRIBE-XFR</td>
      <td class="left"/>
      <td class="left">X</td>
      <td class="left"/>
      <td class="left"/>
      <td class="left"/>
    </tr>
  </tbody>
</table>
<p id="rfc.section.7.4.p.8">Table 2: DSO TLV Client Context Summary </p>
<p id="rfc.section.7.4.p.9">The server TLV contexts are: </p>
<p id="rfc.section.7.4.p.10">S-P:  Server request message, primary TLV </p>
<p id="rfc.section.7.4.p.11">S-U:  Server unidirectional message, primary TLV </p>
<p id="rfc.section.7.4.p.12">S-A:  Server request or unidirectional message, additional TLV </p>
<p id="rfc.section.7.4.p.13">SRP:  Response back to server, primary TLV </p>
<p id="rfc.section.7.4.p.14">SRA:  Response back to server, additional TLV </p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">TLV Type</th>
      <th class="center">S-P</th>
      <th class="center">S-U</th>
      <th class="center">S-A</th>
      <th class="center">SRP</th>
      <th class="center">SRA</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">SUBSCRIBE-XFR</td>
      <td class="center"/>
      <td class="center"/>
      <td class="center"/>
      <td class="center"/>
      <td class="center"/>
    </tr>
    <tr>
      <td class="left">DSO-IXFR</td>
      <td class="center"/>
      <td class="center">X</td>
      <td class="center"/>
      <td class="center"/>
      <td class="center"/>
    </tr>
    <tr>
      <td class="left">DSO-AXFR</td>
      <td class="center"/>
      <td class="center">X</td>
      <td class="center"/>
      <td class="center"/>
      <td class="center"/>
    </tr>
    <tr>
      <td class="left">UNSUBSCRIBE-XFR</td>
      <td class="center"/>
      <td class="center"/>
      <td class="center"/>
      <td class="center"/>
      <td class="center"/>
    </tr>
  </tbody>
</table>
<p id="rfc.section.7.4.p.15">Table 3: DSO TLV Server Context Summary </p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a></h1>
<p id="rfc.section.8.p.1">This document also defines four new DNS Stateful Operation TLV types to be recorded in the IANA DSO Type Code Registry.  </p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="center">Name</th>
      <th class="center">Value</th>
      <th class="center">Early Data</th>
      <th class="center">Status</th>
      <th class="center">Definition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="center">SUBSCRIBE-XFR</td>
      <td class="center">TBA (0x50)</td>
      <td class="center">NO</td>
      <td class="center">Standards Track</td>
      <td class="center">Section 7.1</td>
    </tr>
    <tr>
      <td class="center">DSO-IXFR</td>
      <td class="center">TBA (0x51)</td>
      <td class="center">NA</td>
      <td class="center">Standards Track</td>
      <td class="center">Section 7.1</td>
    </tr>
    <tr>
      <td class="center">DSO-AXFR</td>
      <td class="center">TBA (0x51)</td>
      <td class="center">NA</td>
      <td class="center">Standards Track</td>
      <td class="center">Section 7.2</td>
    </tr>
    <tr>
      <td class="center">UNSUBSCRIBE-XFR</td>
      <td class="center">TBA (0x52)</td>
      <td class="center">NA</td>
      <td class="center">Standards Track</td>
      <td class="center">Section 7.2</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.8.p.2">Table 5: IANA DSO TLV Type Code Assignment </p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#implementation-considerations" id="implementation-considerations">Implementation Considerations</a></h1>
<p id="rfc.section.9.p.1">TBD </p>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> <a href="#implementation-status" id="implementation-status">Implementation Status</a></h1>
<p id="rfc.section.10.p.1">TBD </p>
<h1 id="rfc.section.11"><a href="#rfc.section.11">11.</a> <a href="#iana-considerations-1" id="iana-considerations-1">IANA Considerations</a></h1>
<p id="rfc.section.11.p.1">TBD </p>
<h1 id="rfc.section.12"><a href="#rfc.section.12">12.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a></h1>
<p id="rfc.section.12.p.1">This document specifies a security measure against a DNS risk: the risk that an attacker collects entire DNS zones through eavesdropping on clear text DNS zone transfers. It presents a new Security Consideration for DNS. Some questions to discuss are: </p>
<p/>

<ul>
  <li>Should DoT in this new case be required to use only TLS 1.3 and higher to avoid residual exposure?</li>
  <li>How should padding be used in IXFR?</li>
  <li>Should there be an option to 'pad' an AXFR response (i.e. a set of AXFR responses on a given connection) to hide the zone size?</li>
</ul>

<p> </p>
<h1 id="rfc.section.13"><a href="#rfc.section.13">13.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a></h1>
<h1 id="rfc.section.14"><a href="#rfc.section.14">14.</a> <a href="#changelog" id="changelog">Changelog</a></h1>
<p id="rfc.section.14.p.1">draft-zatda-dprive-xfr-using-dso-00 </p>
<p/>

<ul>
  <li>Initial commit</li>
</ul>

<p> </p>
<h1 id="rfc.references"><a href="#rfc.references">15.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">15.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.hzpa-dprive-xfr-over-tls">[I-D.hzpa-dprive-xfr-over-tls]</b>
      </td>
      <td class="top"><a>Zhang, H.</a>, <a>Aras, P.</a>, <a>Toorop, W.</a>, <a>Dickinson, S.</a> and <a>A. Mankin</a>, "<a href="http://tools.ietf.org/html/draft-hzpa-dprive-xfr-over-tls-01">DNS Zone Transfer over TLS</a>", Internet-Draft draft-hzpa-dprive-xfr-over-tls-01, March 2019.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-dnssd-push">[I-D.ietf-dnssd-push]</b>
      </td>
      <td class="top"><a>Pusateri, T.</a> and <a>S. Cheshire</a>, "<a href="http://tools.ietf.org/html/draft-ietf-dnssd-push-21">DNS Push Notifications</a>", Internet-Draft draft-ietf-dnssd-push-21, July 2019.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6973">[RFC6973]</b>
      </td>
      <td class="top"><a>Cooper, A.</a>, <a>Tschofenig, H.</a>, <a>Aboba, B.</a>, <a>Peterson, J.</a>, <a>Morris, J.</a>, <a>Hansen, M.</a> and <a>R. Smith</a>, "<a href="http://tools.ietf.org/html/rfc6973">Privacy Considerations for Internet Protocols</a>", RFC 6973, DOI 10.17487/RFC6973, July 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7858">[RFC7858]</b>
      </td>
      <td class="top"><a>Hu, Z.</a>, <a>Zhu, L.</a>, <a>Heidemann, J.</a>, <a>Mankin, A.</a>, <a>Wessels, D.</a> and <a>P. Hoffman</a>, "<a href="http://tools.ietf.org/html/rfc7858">Specification for DNS over Transport Layer Security (TLS)</a>", RFC 7858, DOI 10.17487/RFC7858, May 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC8174">[RFC8174]</b>
      </td>
      <td class="top"><a>Leiba, B.</a>, "<a href="http://tools.ietf.org/html/rfc8174">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>", BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC8499">[RFC8499]</b>
      </td>
      <td class="top"><a>Hoffman, P.</a>, <a>Sullivan, A.</a> and <a>K. Fujiwara</a>, "<a href="http://tools.ietf.org/html/rfc8499">DNS Terminology</a>", BCP 219, RFC 8499, DOI 10.17487/RFC8499, January 2019.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">15.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC1995">[RFC1995]</b>
      </td>
      <td class="top"><a>Ohta, M.</a>, "<a href="http://tools.ietf.org/html/rfc1995">Incremental Zone Transfer in DNS</a>", RFC 1995, DOI 10.17487/RFC1995, August 1996.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5936">[RFC5936]</b>
      </td>
      <td class="top"><a>Lewis, E.</a> and <a>A. Hoenes</a>, "<a href="http://tools.ietf.org/html/rfc5936">DNS Zone Transfer Protocol (AXFR)</a>", RFC 5936, DOI 10.17487/RFC5936, June 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC8490">[RFC8490]</b>
      </td>
      <td class="top"><a>Bellis, R.</a>, <a>Cheshire, S.</a>, <a>Dickinson, J.</a>, <a>Dickinson, S.</a>, <a>Lemon, T.</a> and <a>T. Pusateri</a>, "<a href="http://tools.ietf.org/html/rfc8490">DNS Stateful Operations</a>", RFC 8490, DOI 10.17487/RFC8490, March 2019.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Han Zhang</span> 
	  <span class="n hidden">
		<span class="family-name">Zhang</span>
	  </span>
	</span>
	<span class="org vcardline">Salesforce</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">San Francisco, CA</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">United States</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:hzhang@salesforce.com">hzhang@salesforce.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Pallavi Aras</span> 
	  <span class="n hidden">
		<span class="family-name">Aras</span>
	  </span>
	</span>
	<span class="org vcardline">Salesforce</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Herndon, VA</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">United States</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:paras@salesforce.com">paras@salesforce.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Willem Toorop</span> 
	  <span class="n hidden">
		<span class="family-name">Toorop</span>
	  </span>
	</span>
	<span class="org vcardline">NLnet Labs</span>
	<span class="adr">
	  <span class="vcardline">Science Park 400</span>

	  <span class="vcardline">
		<span class="locality">Amsterdam</span>,  
		<span class="region"></span>
		<span class="code">1098 XH</span>
	  </span>
	  <span class="country-name vcardline">The Netherlands</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:willem@nlnetlabs.nl">willem@nlnetlabs.nl</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Sara Dickinson</span> 
	  <span class="n hidden">
		<span class="family-name">Dickinson</span>
	  </span>
	</span>
	<span class="org vcardline">Sinodun IT</span>
	<span class="adr">
	  <span class="vcardline">Magdalen Centre</span>
<span class="vcardline">Oxford Science Park</span>

	  <span class="vcardline">
		<span class="locality">Oxford</span>,  
		<span class="region"></span>
		<span class="code">OX4 4GA</span>
	  </span>
	  <span class="country-name vcardline">United Kingdom</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:sara@sinodun.com">sara@sinodun.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Allison Mankin</span> 
	  <span class="n hidden">
		<span class="family-name">Mankin</span>
	  </span>
	</span>
	<span class="org vcardline">Salesforce</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Herndon, VA</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">United States</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:allison.mankin@gmail.com">allison.mankin@gmail.com</a></span>

  </address>
</div>

</body>
</html>
